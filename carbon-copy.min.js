(function(){class CarbonCopy extends HTMLElement{static get observedAttributes(){return['href','composed','get','set','get-props','set-props','stamp-href']}absolute(a,b){var c=a.split('/'),d=b.split('/');c.pop();for(var f=0;f<d.length;f++)'.'!=d[f]&&('..'==d[f]?c.pop():c.push(d[f]));return c.join('/')}appendTemplateElementInsideShadowRootToInnerHTML(a,b){const f=a.getElementById(b),g=document.importNode(f.content,!0);if(this._stampHref){const h=this.querySelectorAll('[c-c-initial-child]');for(let j=0,k=h.length;j<k;j++)h[j].style.display='none';for(let j=0,k=g.children.length;j<k;j++){const l=g.children[j];l.setAttribute('c-c-href-stamp',this._href)}}this.appendChild(g)}loadHref(){if(!this._initialized){if(this._stampHref){const a=this.children;for(let b=0,c=a.length-1;b<c;b++)a[b].setAttribute('c-c-initial-child','true')}this._initialized=!0}if(this._href){let needToProcessFurther=!0;if(this._stampHref){const a=this.querySelectorAll(':scope > [c-c-href-stamp]');for(let b=0,c=a.length;b<c;b++){const d=a[b];d.getAttribute('c-c-href-stamp')===this._href?(needToProcessFurther=!1,d.style.display=d.c_c_originalStyle):(d.c_c_originalStyle=d.style.display,d.style.display='none')}}if(needToProcessFurther){const splitHref=this._href.split('#');if(!(2>splitHref.length)){const url=splitHref[0],id=splitHref[1];if(0===url.length)return void this.appendTemplateElementInsideShadowRootToInnerHTML(document,id,null,url);const isAbsTests=['https://','/','//','http://'];let isAbsolute=!1;for(let a=0,b=isAbsTests.length;a<b;a++)if(url.startsWith(isAbsTests[a])){this._absUrl=url,isAbsolute=!0;break}isAbsolute||(this._absUrl=this.absolute(location.href,url));const absUrl=this._absUrl;let shadowDOM=CarbonCopy._shadowDoms[absUrl];if(shadowDOM)switch(typeof shadowDOM){case'boolean':const a=CarbonCopy._shadowDomSubscribers,b=c=>{this.appendTemplateElementInsideShadowRootToInnerHTML(c,id,absUrl,url)};a[absUrl]?a[absUrl].push(b):a[absUrl]=[b];break;case'object':this.appendTemplateElementInsideShadowRootToInnerHTML(shadowDOM,id,absUrl,url);}else CarbonCopy._shadowDoms[absUrl]=!0,fetch(absUrl).then(resp=>{resp.text().then(txt=>{const container=document.createElement('div');container.style.display='none',document.body.appendChild(container);const shadowRoot=container.attachShadow({mode:'open'});CarbonCopy._shadowDoms[absUrl]=shadowRoot;const parser=new DOMParser;let docFrag=parser.parseFromString(txt,'text/html');if(docFrag.head){const metaProcessors=docFrag.head.querySelectorAll('meta[name="preprocessor"]');for(let i=0,ii=metaProcessors.length;i<ii;i++){const metaProcessorTag=metaProcessors[i],metaProcessorIdentifier=metaProcessorTag.getAttribute('content'),metaProcessor=eval(metaProcessorIdentifier);docFrag=metaProcessor(docFrag,this)}}shadowRoot.appendChild(docFrag.body),this.appendTemplateElementInsideShadowRootToInnerHTML(shadowRoot,id,absUrl,url);const subscribers=CarbonCopy._shadowDomSubscribers[absUrl];subscribers&&(subscribers.forEach(a=>a(shadowRoot)),delete CarbonCopy._shadowDomSubscribers[absUrl])})})}}}}connectedCallback(){if(this._set){const a=this._set.split(';');a.forEach(b=>{const c=b.split(':'),d=c[0],f=c[1];this.addEventListener('c-c-get-'+d,g=>{g.detail.value=f;const h=this.getAttribute(d+'-props');if(h){const j=h.split(';');j.forEach(k=>{const l=k.split(':'),m=l[0],n=l[1],o=m.split('.');let p=g.srcElement;const q=o.length;for(let s=0;s<q-1;s++)p=p[o[s]];const r=o[q-1];switch(typeof p[r]){case'string':p[r]=n;break;default:throw'not implemented yet';}})}})})}if(this._setProps){const a=this._setProps.split(';');a.forEach(b=>{console.log('add listener for c-c-get-props-'+b),this.addEventListener('c-c-get-props-'+b,c=>{c.detail.value=this[b];const d=c.srcElement.nextElementSibling;Object.defineProperty(this,b,{enumerable:!0,configurable:!0,set:function(g){d[b]=g}})})})}if(this._get){const a=new CustomEvent('c-c-get-'+this._get,{detail:{},bubbles:!0,composed:this._composed});this.dispatchEvent(a),this.innerHTML=a.detail.value}if(this._getProps){const a=this._getProps.split(';');a.forEach(b=>{const c=new CustomEvent('c-c-get-props-'+b,{detail:{},bubbles:!0,composed:this._composed});console.log('dispatching get props event: c-c-get-props-'+b),this.dispatchEvent(c)})}this.loadHref()}attributeChangedCallback(a,b,c){'href'===a?(this._href=c,this._initialized&&this.loadHref()):'stamp-href'===a?this._stampHref=void 0!==c:'composed'===a?this._composed=null!==c:this['_'+a.replace('-','_')]=c}set href(a){this.setAttribute('href',a)}get href(){return this._href}}CarbonCopy._shadowDoms={},CarbonCopy._shadowDomSubscribers={};customElements.define('carbon-copy',CarbonCopy),customElements.define('c-c',class extends CarbonCopy{})})();